(self.webpackChunkarrowsoft_project_management=self.webpackChunkarrowsoft_project_management||[]).push([[709],{3709:(e,t,n)=>{"use strict";n.r(t),n.d(t,{DetailsModule:()=>U});var i=n(8583),s=n(3679),o=n(1095),a=n(6627),r=n(9983),c=n(7441),m=n(7001),g=n(4655),d=n(7716),l=n(2340),u=n(1841);let p=(()=>{class e{constructor(e){this.http=e,this.URL=l.N.BASE_API_URL}sendMessage(e){return this.http.post(`${this.URL}/task-comment/store`,e)}getMessages(e){return this.http.get(`${this.URL}/task-comment/${e}`)}deleteMessage(e){return this.http.delete(`${this.URL}/task-comment/delete/${e}`)}}return e.\u0275fac=function(t){return new(t||e)(d.LFG(u.eN))},e.\u0275prov=d.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var f=n(6767),h=n(5832),_=n(4674),b=n(6138),M=n(7659),Z=n(8295),A=n(2458);function O(e,t){1&e&&(d.TgZ(0,"p"),d._uU(1,"Loading..."),d.qZA())}function C(e,t){if(1&e&&(d.TgZ(0,"mat-option",20),d._uU(1),d.qZA()),2&e){const e=t.$implicit;d.Q6J("value",e.id),d.xp6(1),d.hij(" ",e.first_name+" "+e.last_name," ")}}function P(e,t){1&e&&(d.TgZ(0,"button",21),d._uU(1," Update Task "),d.qZA())}function k(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",22),d.TgZ(1,"button",23),d.NdJ("click",function(){return d.CHM(e),d.oxw(2).deleteTask()}),d._uU(2," Delete Task "),d.qZA(),d.qZA()}}function S(e,t){if(1&e&&(d.TgZ(0,"span"),d._uU(1),d.ALo(2,"uppercase"),d.qZA()),2&e){const e=d.oxw().$implicit;d.xp6(1),d.hij(" ",d.lcZ(2,1,e.username)," at ")}}function v(e,t){if(1&e&&d._UZ(0,"img",28),2&e){const e=d.oxw().$implicit;d.Q6J("src","https://niramoy.xyz/"+e.file,d.LSH)("alt",e.comment)}}function x(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"button",29),d.NdJ("click",function(){d.CHM(e);const t=d.oxw().$implicit;return d.oxw(2).deleteMessage(t.id)}),d.TgZ(1,"mat-icon"),d._uU(2,"delete"),d.qZA(),d.qZA()}}function T(e,t){if(1&e&&(d.TgZ(0,"div",24),d.TgZ(1,"p",25),d.YNc(2,S,3,3,"span",0),d._uU(3),d.ALo(4,"uppercase"),d.ALo(5,"date"),d.qZA(),d.TgZ(6,"p"),d._uU(7),d.qZA(),d.YNc(8,v,1,2,"img",26),d.YNc(9,x,3,0,"button",27),d.qZA()),2&e){const e=t.$implicit,n=d.oxw(2);d.ekj("sent",n.isAdmin.userName===e.username),d.xp6(2),d.Q6J("ngIf",n.isAdmin.userName!==e.username),d.xp6(1),d.AsE(" ",e.created_at.split(" ")[1]," on ",d.lcZ(4,8,d.lcZ(5,10,e.created_at))," "),d.xp6(4),d.Oqu(e.comment),d.xp6(1),d.Q6J("ngIf",e.file),d.xp6(1),d.Q6J("ngIf",n.isAdmin.userName===e.username)}}function w(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",2),d.TgZ(1,"div",3),d.TgZ(2,"div",4),d.TgZ(3,"h2"),d._uU(4),d.ALo(5,"titlecase"),d.qZA(),d.TgZ(6,"p"),d._uU(7),d.qZA(),d.qZA(),d.TgZ(8,"div",5),d.TgZ(9,"form"),d.TgZ(10,"mat-form-field",6),d.TgZ(11,"mat-label"),d._uU(12,"Members"),d.qZA(),d.TgZ(13,"mat-select",7),d.YNc(14,C,2,2,"mat-option",8),d.qZA(),d.qZA(),d.YNc(15,P,2,0,"button",9),d.qZA(),d.qZA(),d.YNc(16,k,3,0,"div",10),d.qZA(),d.TgZ(17,"div",11),d.TgZ(18,"form",12),d.TgZ(19,"mat-form-field",6),d.TgZ(20,"mat-label"),d._uU(21,"Send Message"),d.qZA(),d._UZ(22,"input",13),d.TgZ(23,"button",14),d.TgZ(24,"mat-icon"),d._uU(25,"attach_file"),d.qZA(),d._UZ(26,"input",15,16),d.qZA(),d.TgZ(28,"button",17),d.NdJ("click",function(t){d.CHM(e);const n=d.MAs(27);return d.oxw().sendMessage(t,n)}),d.TgZ(29,"mat-icon"),d._uU(30,"send"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(31,"div",18),d.YNc(32,T,10,12,"div",19),d.qZA(),d.qZA(),d.qZA()}if(2&e){const e=d.oxw();d.xp6(4),d.Oqu(d.lcZ(5,8,e.TASK.task_title)),d.xp6(3),d.Oqu(e.TASK.task_details),d.xp6(6),d.Q6J("formControl",e.members),d.xp6(1),d.Q6J("ngForOf",e.MEMBERS),d.xp6(1),d.Q6J("ngIf",e.isAdmin.isAdmin),d.xp6(1),d.Q6J("ngIf",e.isAdmin.isAdmin||e.members.value===e.isAdmin.userID),d.xp6(2),d.Q6J("formGroup",e.message),d.xp6(14),d.Q6J("ngForOf",e.MESSAGES)}}const q=[{path:"",component:(()=>{class e{constructor(e,t,n,i,o,a,r,c){this.messageService=e,this.isAdmin=t,this.snackbarService=n,this.memberService=i,this.taskService=o,this.router=a,this.route=r,this.confirmService=c,this.message=new s.cw({task_id:new s.NI(""),user_id:new s.NI(this.isAdmin.userID),comment:new s.NI(""),file:new s.NI("")}),this.members=new s.NI({value:"",disabled:!this.isAdmin.isAdmin})}ngOnInit(){this.memberService.getMembers().subscribe(e=>{this.MEMBERS=e}),this.route.paramMap.subscribe(e=>{const t=e.params.id;this.taskService.getSpecificTask(t).subscribe(e=>{this.TASK=e[0],this.members.patchValue(this.TASK.members.map(e=>e.id)[0])}),this.messageService.getMessages(t).subscribe(e=>{this.MESSAGES=e.data})})}sendMessage(e,t){e.preventDefault(),this.message.patchValue(t.files.length?{task_id:this.TASK.id,file:t.files[0]}:{task_id:this.TASK.id});const{comment:n,file:i}=this.message.value;if(n||i){const e=new FormData;for(let t in this.message.value)e.append(t,this.message.value[t]);this.messageService.sendMessage(e).subscribe(()=>{this.MESSAGES.push(Object.assign(Object.assign({},this.message.value),{username:this.isAdmin.userName}))},e=>{console.log(e),this.snackbarService.openSnackBar("Internal Server Error! Try Again Later")})}else this.snackbarService.openSnackBar("Nothing to Send!")}deleteTask(){this.confirmService.confirm("Are you sure you want to delete this task?").subscribe(e=>{e?this.taskService.deleteTask(this.TASK.id).subscribe(()=>{this.snackbarService.openSnackBar("Task Deleted Successfully!"),this.router.navigateByUrl("/tasks")}):this.snackbarService.openSnackBar("Everything is Unchanged!")})}deleteMessage(e){this.confirmService.confirm("Are you sure you want to delete this message?").subscribe(t=>{t&&this.messageService.deleteMessage(e).subscribe(()=>this.snackbarService.openSnackBar("Message Deleted Successfully!"))})}}return e.\u0275fac=function(t){return new(t||e)(d.Y36(p),d.Y36(f.q),d.Y36(h.o),d.Y36(_.Z),d.Y36(b.M),d.Y36(g.F0),d.Y36(g.gz),d.Y36(M.Y))},e.\u0275cmp=d.Xpm({type:e,selectors:[["app-details"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],[1,"information"],[1,"card","task"],[1,"card","controls"],["appearance","outline"],[3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",4,"ngIf"],["class","card delete",4,"ngIf"],[1,"discuss"],[1,"send-message",3,"formGroup"],["matInput","","autocomplete","off","formControlName","comment"],["mat-icon-button","","matSuffix","","type","button","id","file-upload"],["type","file"],["file",""],["mat-icon-button","","matSuffix","","type","submit",3,"click"],[1,"chat"],["class","message",3,"sent",4,"ngFor","ngForOf"],[3,"value"],["mat-raised-button","","color","primary"],[1,"card","delete"],["mat-raised-button","","color","accent",3,"click"],[1,"message"],[1,"message-information"],[3,"src","alt",4,"ngIf"],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],[3,"src","alt"],["mat-icon-button","","matSuffix","",3,"click"]],template:function(e,t){1&e&&(d.YNc(0,O,2,0,"p",0),d.YNc(1,w,33,10,"div",1)),2&e&&(d.Q6J("ngIf",!t.TASK),d.xp6(1),d.Q6J("ngIf",t.TASK))},directives:[i.O5,s._Y,s.JL,Z.KE,Z.hX,c.gD,s.JJ,s.oH,i.sg,s.sg,r.Nt,s.Fj,s.u,o.lW,Z.R9,a.Hw,A.ey],pipes:[i.rS,i.gd,i.uU],styles:[".container[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;grid-gap:1rem;gap:1rem}.container[_ngcontent-%COMP%]   .information[_ngcontent-%COMP%]{padding:0 1rem}.container[_ngcontent-%COMP%]   .information[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{padding:1rem;background:#00081405;border:2px solid #00081410;border-radius:.7rem;margin-bottom:1rem;text-align:center}.container[_ngcontent-%COMP%]   .information[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:0}.container[_ngcontent-%COMP%]   .information[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:block;width:100px;height:100px;border:2px solid #00081420;border-radius:50%;margin:0 auto;background:#00081410}.container[_ngcontent-%COMP%]   .information[_ngcontent-%COMP%]   .task[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .information[_ngcontent-%COMP%]   .task[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{max-width:250px}.discuss[_ngcontent-%COMP%]{max-height:calc(90vh - 3rem);padding:1rem;background:#00081405;border:2px solid #00081410;border-radius:1rem;position:relative}.discuss[_ngcontent-%COMP%]   .send-message[_ngcontent-%COMP%]{padding:1rem;position:absolute;bottom:0;left:0;width:100%;display:flex;align-items:center}.discuss[_ngcontent-%COMP%]   .send-message[_ngcontent-%COMP%]     .mat-form-field-wrapper{margin-bottom:-1.25em}.controls[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;margin-bottom:1rem}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .delete[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}@media (max-width: 750px){.container[_ngcontent-%COMP%]{grid-template-columns:1fr}.container[_ngcontent-%COMP%]   .information[_ngcontent-%COMP%]{padding:0}.container[_ngcontent-%COMP%]   .discuss[_ngcontent-%COMP%]{min-height:200px}}.mat-form-field[_ngcontent-%COMP%]{width:100%}#file-upload[_ngcontent-%COMP%]{position:relative;overflow:hidden;cursor:pointer}#file-upload[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;opacity:0;width:100%;height:100%}.chat[_ngcontent-%COMP%]{max-height:90%;overflow-y:auto;padding-right:1rem;display:flex;flex-direction:column;grid-gap:1rem;gap:1rem}.chat[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.chat[_ngcontent-%COMP%]::-webkit-scrollbar-track{opacity:0}.chat[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#0008141a}.message[_ngcontent-%COMP%]{position:relative;max-width:70%;align-self:flex-start;background:#00081410;padding:.5rem 1rem;border-radius:.5rem}.message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;padding:0}.message[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:200px;max-width:100%;border-radius:.25rem;margin-top:.5rem}.message[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{position:absolute;top:0;left:-40px;transform:scale(.9);opacity:.1;transition:.2s ease}.message[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{opacity:1}.message-information[_ngcontent-%COMP%]{font-size:.75rem;color:#00081470}.sent[_ngcontent-%COMP%]{align-self:flex-end;background:#d5032410}"]}),e})()}];let y=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.oAB({type:e}),e.\u0275inj=d.cJS({imports:[[g.Bz.forChild(q)],g.Bz]}),e})(),U=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.oAB({type:e}),e.\u0275inj=d.cJS({imports:[[i.ez,y,r.c,o.ot,a.Ps,s.UX,m.ZX,c.LD]]}),e})()}}]);